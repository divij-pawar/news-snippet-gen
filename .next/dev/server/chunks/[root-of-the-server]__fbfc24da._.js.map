{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 202, "column": 0}, "map": {"version":3,"sources":["file:///media/divijpawar/46F0FDACF0FDA27B/Code/news-snippet-gen/app/api/generate/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server'\nimport * as cheerio from 'cheerio'\nimport sharp from 'sharp'\n\nexport async function POST(request: NextRequest) {\n  try {\n    const { url } = await request.json()\n\n    if (!url || typeof url !== 'string') {\n      return NextResponse.json(\n        { error: 'URL is required' },\n        { status: 400 }\n      )\n    }\n\n    // Validate URL format\n    try {\n      new URL(url)\n    } catch {\n      return NextResponse.json(\n        { error: 'Invalid URL format' },\n        { status: 400 }\n      )\n    }\n\n    // Fetch the article HTML\n    const htmlResponse = await fetch(url, {\n      headers: {\n        'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36',\n      },\n    })\n\n    if (!htmlResponse.ok) {\n      return NextResponse.json(\n        { error: `Failed to fetch article: ${htmlResponse.statusText}` },\n        { status: 500 }\n      )\n    }\n\n    const html = await htmlResponse.text()\n    const $ = cheerio.load(html)\n\n    // Extract metadata using Open Graph tags with fallbacks\n    const title = \n      $('meta[property=\"og:title\"]').attr('content') ||\n      $('meta[name=\"twitter:title\"]').attr('content') ||\n      $('title').text() ||\n      'Untitled Article'\n\n    const imageUrl = \n      $('meta[property=\"og:image\"]').attr('content') ||\n      $('meta[name=\"twitter:image\"]').attr('content') ||\n      $('meta[property=\"og:image:url\"]').attr('content')\n\n    const author = \n      $('meta[name=\"author\"]').attr('content') ||\n      $('meta[property=\"article:author\"]').attr('content') ||\n      $('.author').first().text().trim() ||\n      $('[rel=\"author\"]').first().text().trim() ||\n      'Unknown Author'\n\n    if (!imageUrl) {\n      return NextResponse.json(\n        { error: 'No article image found. Please try a different article.' },\n        { status: 400 }\n      )\n    }\n\n    // Fetch the article image\n    let imageBuffer: Buffer\n    try {\n      const imageResponse = await fetch(imageUrl)\n      if (!imageResponse.ok) {\n        throw new Error('Failed to fetch image')\n      }\n      imageBuffer = Buffer.from(await imageResponse.arrayBuffer())\n    } catch (error) {\n      console.error('[v0] Error fetching image:', error)\n      return NextResponse.json(\n        { error: 'Failed to fetch article image' },\n        { status: 500 }\n      )\n    }\n\n    // Generate the square card using Sharp\n    const cardSize = 800\n    const imageHeight = Math.floor(cardSize * 0.5)\n    const textAreaHeight = cardSize - imageHeight\n\n    // Process and resize the article image\n    const processedImage = await sharp(imageBuffer)\n      .resize(cardSize, imageHeight, {\n        fit: 'cover',\n        position: 'center',\n      })\n      .toBuffer()\n\n    // Clean up title and author for better display\n    const cleanTitle = title.length > 120 ? title.substring(0, 120) + '...' : title\n    const cleanAuthor = author.toUpperCase()\n\n    // Create text overlay SVG\n    const textSvg = `\n      <svg width=\"${cardSize}\" height=\"${textAreaHeight}\">\n        <rect width=\"${cardSize}\" height=\"${textAreaHeight}\" fill=\"#ffffff\"/>\n        \n        <text x=\"${cardSize / 2}\" y=\"60\" font-family=\"Arial, sans-serif\" font-size=\"16\" font-weight=\"600\" fill=\"#666\" text-anchor=\"middle\">\n          BY: ${cleanAuthor}\n        </text>\n        \n        <foreignObject x=\"40\" y=\"90\" width=\"${cardSize - 80}\" height=\"${textAreaHeight - 120}\">\n          <div xmlns=\"http://www.w3.org/1999/xhtml\" style=\"font-family: Arial, sans-serif; font-size: 28px; font-weight: bold; color: #111; text-align: center; line-height: 1.3; display: flex; align-items: center; justify-content: center; height: 100%; padding: 0 20px;\">\n            ${cleanTitle}\n          </div>\n        </foreignObject>\n      </svg>\n    `\n\n    // Composite the final image\n    const finalImage = await sharp({\n      create: {\n        width: cardSize,\n        height: cardSize,\n        channels: 3,\n        background: { r: 255, g: 255, b: 255 },\n      },\n    })\n      .composite([\n        { input: processedImage, top: 0, left: 0 },\n        { input: Buffer.from(textSvg), top: imageHeight, left: 0 },\n      ])\n      .png()\n      .toBuffer()\n\n    // Convert to base64\n    const base64Image = `data:image/png;base64,${finalImage.toString('base64')}`\n\n    return NextResponse.json({ \n      image: base64Image,\n      metadata: { title, author, imageUrl }\n    })\n\n  } catch (error) {\n    console.error('[v0] Error generating image:', error)\n    return NextResponse.json(\n      { error: 'An unexpected error occurred while generating the image' },\n      { status: 500 }\n    )\n  }\n}\n"],"names":[],"mappings":"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"}}]
}